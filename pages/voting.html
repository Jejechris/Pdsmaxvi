<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pemilihan Ketua & Wakil - PDSMAXVI</title>
  <meta name="description" content="Pemilihan ketua dan wakil ketua organisasi Kristen PDSMAXVI">
  <link rel="canonical" href="voting.html">
  <meta property="og:title" content="Pemilihan Ketua & Wakil - PDSMAXVI">
  <meta property="og:description" content="Pemilihan ketua dan wakil ketua organisasi Kristen PDSMAXVI">
  <meta property="og:type" content="website">
  <meta property="og:image" content="../assets/pdsmaxvi.jpg">
  <meta property="og:url" content="voting.html">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Pemilihan Ketua & Wakil - PDSMAXVI">
  <meta name="twitter:description" content="Pemilihan ketua dan wakil ketua organisasi Kristen PDSMAXVI">
  <meta name="twitter:image" content="../assets/pdsmaxvi.jpg">
  <link rel="manifest" href="../config/manifest.json">
  <meta name="theme-color" content="#5c3c92">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- <link rel="icon" href="favicon.png" type="image/png"> -->
  <link rel="stylesheet" href="../config/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="../scripts/firebase-config.js"></script>

  <style>
    .voting-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .voting-header {
      text-align: center;
      margin-bottom: 40px;
      padding: 40px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .voting-header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .voting-header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .voting-status {
      display: inline-block;
      padding: 8px 20px;
      background: rgba(255,255,255,0.2);
      border-radius: 25px;
      margin-top: 15px;
      font-weight: 600;
    }

    .status-active {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      animation: pulse 2s infinite;
    }

    .status-closed {
      background: linear-gradient(45deg, #f44336, #d32f2f);
      color: white;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .candidates-section {
      margin-bottom: 50px;
    }

    .section-title {
      text-align: center;
      font-size: 2em;
      margin-bottom: 30px;
      color: #333;
      position: relative;
    }

    .section-title::after {
      content: '';
      display: block;
      width: 100px;
      height: 4px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      margin: 10px auto;
      border-radius: 2px;
    }

    .candidates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .pairs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
      gap: 40px;
      margin-bottom: 40px;
    }

    .candidate-pair {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
      transition: all 0.3s ease;
      border: 3px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .candidate-pair::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .candidate-pair:hover::before {
      left: 100%;
    }

    .candidate-pair:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }

    .candidate-pair.selected {
      border-color: #4CAF50;
      background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
    }

    .pair-header {
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .pair-title {
      font-size: 1.5em;
      color: var(--purple);
      margin-bottom: 10px;
      font-weight: bold;
    }

    .team-vision {
      font-style: italic;
      color: #666;
      font-size: 0.9em;
    }

    .candidates-in-pair {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 25px;
    }

    .candidate-in-pair {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 15px;
      border: 2px solid #e9ecef;
    }

    .candidate-in-pair.ketua {
      border-color: #ffc107;
      background: linear-gradient(135deg, #fff8e1 0%, #fffbf0 100%);
    }

    .candidate-in-pair.wakil {
      border-color: #17a2b8;
      background: linear-gradient(135deg, #e1f5fe 0%, #f0f9ff 100%);
    }

    .pair-vote-count {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e9ecef;
    }

    .pair-vote-count .vote-count {
      font-weight: bold;
      color: var(--purple);
    }

    /* Results styling */
    .result-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }

    .result-card:hover {
      transform: translateY(-5px);
    }

    .result-card.pair-result {
      padding: 30px;
    }

    .result-rank {
      font-size: 2em;
      font-weight: bold;
      color: var(--purple);
      margin-bottom: 15px;
    }

    .result-photo {
      font-size: 3em;
      margin-bottom: 15px;
    }

    .result-name {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .result-position {
      color: #666;
      margin-bottom: 15px;
    }

    .result-votes {
      font-size: 1.5em;
      font-weight: bold;
      color: #4CAF50;
      margin-bottom: 10px;
    }

    .pair-candidates {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .result-candidate {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .pair-separator {
      font-size: 1.5em;
      font-weight: bold;
      color: var(--purple);
    }

    .results-section {
      margin-top: 50px;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 20px;
    }

    .results-title {
      text-align: center;
      font-size: 2em;
      color: var(--purple);
      margin-bottom: 30px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 30px;
    }

    .candidate-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
      transition: all 0.3s ease;
      border: 3px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .candidate-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .candidate-card:hover::before {
      left: 100%;
    }

    .candidate-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }

    .candidate-card.selected {
      border-color: #4CAF50;
      background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
    }

    .candidate-photo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3em;
      color: white;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .candidate-name {
      font-size: 1.5em;
      font-weight: 700;
      margin-bottom: 10px;
      color: #333;
    }

    .candidate-position {
      font-size: 1.1em;
      color: #666;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .candidate-vision {
      font-size: 0.95em;
      color: #555;
      line-height: 1.6;
      margin-bottom: 20px;
      font-style: italic;
    }

    .vote-button {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .vote-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
    }

    .vote-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .vote-button.voted {
      background: linear-gradient(45deg, #2196F3, #1976D2);
    }

    .vote-count {
      margin-top: 15px;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 10px;
      font-weight: 600;
      color: #333;
    }

    .results-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-top: 40px;
    }

    .results-title {
      text-align: center;
      font-size: 1.8em;
      margin-bottom: 30px;
      color: #333;
    }

    .results-grid {
      display: grid;
      gap: 20px;
    }

    .result-item {
      display: flex;
      align-items: center;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 15px;
      border-left: 5px solid #4CAF50;
    }

    .result-rank {
      font-size: 2em;
      font-weight: 700;
      color: #4CAF50;
      margin-right: 20px;
      min-width: 60px;
    }

    .result-info {
      flex: 1;
    }

    .result-name {
      font-size: 1.3em;
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }

    .result-position {
      color: #666;
      margin-bottom: 10px;
    }

    .result-votes {
      font-size: 1.1em;
      font-weight: 600;
      color: #4CAF50;
    }

    .voting-instructions {
      background: linear-gradient(135deg, #ffeaa7, #fab1a0);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      border-left: 5px solid #e17055;
    }

    .voting-instructions h3 {
      margin-bottom: 15px;
      color: #2d3436;
      font-size: 1.3em;
    }

    .voting-instructions ul {
      margin: 0;
      padding-left: 20px;
      color: #2d3436;
    }

    .voting-instructions li {
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border-left: 5px solid #c62828;
    }

    .success-message {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border-left: 5px solid #2e7d32;
    }

    @media (max-width: 768px) {
      .voting-header h1 {
        font-size: 2em;
      }
      
      .candidates-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .pairs-grid {
        grid-template-columns: 1fr;
        gap: 25px;
      }

      .candidates-in-pair {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .candidate-card {
        padding: 20px;
      }
      
      .candidate-photo {
        width: 100px;
        height: 100px;
        font-size: 2.5em;
      }
    }
  </style>
</head>
<body>
  <button id="back-to-top" aria-label="Kembali ke atas" title="Back to top">↑</button>
  
  <nav>
    <div class="nav-inner container">
      <div class="logo"><a href="../index.html" style="text-decoration:none;color:inherit;"><h4>PDSMAXVI</h4></a></div>
      <ul class="nav-links" aria-hidden="true">
        <li><a href="../index.html">Beranda</a></li>
        <li><a href="pesan.html">Pesan</a></li>
        <li><a href="struktur.html">Pengurus</a></li>
        <li><a href="quiz.html">Kuis</a></li>
        <li><a href="galeri.html">Timeline</a></li>
        <li><a href="voting.html" class="active">Voting</a></li>
        <li><a href="harapan.html">Harapan</a></li>
        <li><a href="surat-unik.html">Surat Unik</a></li>
        <li><a href="email-scheduler.html">✝ Email Scheduler</a></li>
      </ul>
      <div class="hamburger" role="button" aria-label="Menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div>
    </div>
  </nav>

  <header class="hero hero-galeri">
    <div class="hero-content" data-aos="fade-up">
      <h1>Pemilihan Ketua & Wakil</h1>
      <p>Pilih pemimpin terbaik untuk masa depan organisasi Kristen kita</p>
    </div>
  </header>

  <div class="voting-container">
    <div class="voting-header" data-aos="fade-up">
      <h1>🗳️ Pemilihan Ketua & Wakil Ketua</h1>
      <p>Organisasi Kristen PDSMAXVI</p>
      <div class="voting-status" id="votingStatus">
        <i class="fas fa-clock"></i> Memuat...
      </div>
    </div>

    <div class="voting-instructions" data-aos="fade-up">
      <h3><i class="fas fa-info-circle"></i> Cara Memilih:</h3>
      <ul>
        <li>Pilih <strong>satu kandidat ketua</strong> dan <strong>satu kandidat wakil ketua</strong></li>
        <li>Klik tombol "Pilih" pada kandidat yang Anda inginkan</li>
        <li>Setelah memilih, Anda tidak dapat mengubah pilihan</li>
        <li>Hasil voting akan ditampilkan secara real-time</li>
      </ul>
    </div>

    <div id="loadingMessage" class="loading">
      <i class="fas fa-spinner fa-spin"></i> Memuat kandidat...
    </div>

    <div id="errorMessage" class="error-message" style="display: none;">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="errorText"></span>
    </div>

    <div id="successMessage" class="success-message" style="display: none;">
      <i class="fas fa-check-circle"></i>
      <span id="successText"></span>
    </div>

    <!-- Pasangan Kandidat -->
    <div class="candidates-section">
      <h2 class="section-title">👥 Pasangan Kandidat Ketua & Wakil Ketua</h2>
      <div class="pairs-grid" id="candidatePairs">
        <!-- Pasangan kandidat akan dimuat dari JavaScript -->
      </div>
    </div>

    <!-- Hasil Voting -->
    <div class="results-section" data-aos="fade-up" id="resultsSection">
      <h2 class="results-title">📊 Hasil Voting</h2>
      <div class="results-grid" id="resultsGrid">
        <!-- Hasil akan dimuat dari JavaScript -->
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 Perpisahan Angkatan XII - Semua Hak Cipta Dilindungi</p>
    <div class="footer-links">
      <a href="../index.html">Beranda</a> |
      <a href="pesan.html">Pesan</a> |
      <a href="quiz.html">Kuis</a> |
      <a href="voting.html" class="active">Voting</a> |
      <a href="harapan.html">Harapan</a>
    </div>
    <div class="social-icons">
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-youtube"></i></a>
      <a href="#"><i class="fab fa-whatsapp"></i></a>
    </div>
  </footer>

  <script src="../scripts/app.js"></script>
  <script>
    // Inisialisasi Firebase dan sistem voting
    let votingDatabase;
    let currentUser = null;
    let votingOpen = true;
    let userVotes = { pair: null, ketua: null, wakil: null };

    // Data kandidat - 2 pasangan untuk testing
    const candidatePairs = [
      {
        id: 'pair1',
        ketua: {
          id: 'ketua1',
          name: 'Alexander Johnson',
          position: 'Ketua',
          vision: '"Membangun persekutuan yang kuat dalam kasih Kristus dan melayani dengan hati yang tulus"',
          photo: '👨‍💼'
        },
        wakil: {
          id: 'wakil1',
          name: 'Emma Davis',
          position: 'Wakil Ketua',
          vision: '"Mendukung visi ketua dengan dedikasi tinggi dan komitmen untuk melayani sesama"',
          photo: '👩‍🎓'
        },
        teamVision: '"Tim yang kompak untuk melayani dengan kasih dan membangun persekutuan yang kuat"'
      },
      {
        id: 'pair2',
        ketua: {
          id: 'ketua2',
          name: 'Sarah Williams',
          position: 'Ketua',
          vision: '"Menginspirasi generasi muda untuk hidup sesuai dengan firman Tuhan dan menjadi berkat bagi sesama"',
          photo: '👩‍💼'
        },
        wakil: {
          id: 'wakil2',
          name: 'David Wilson',
          position: 'Wakil Ketua',
          vision: '"Membangun jembatan komunikasi yang efektif dan memastikan setiap suara didengar"',
          photo: '👨‍💻'
        },
        teamVision: '"Kolaborasi yang solid untuk menginspirasi dan melayani generasi muda"'
      }
    ];

    // Inisialisasi aplikasi
    document.addEventListener('DOMContentLoaded', function() {
      initializeFirebase();
      initializeVoting();
    });

    function initializeFirebase() {
      try {
        // Initialize Firebase using the config from firebase-config.js
        if (typeof firebase !== 'undefined') {
          if (firebase.apps.length === 0) {
            // Initialize Firebase if not already initialized
            firebase.initializeApp({
              apiKey: "AIzaSyB3UzjOPcI7fn-u9x_qR7pXzw6EvcDzASU",
              authDomain: "pdsmaxvi-ac5fc.firebaseapp.com",
              databaseURL: "https://pdsmaxvi-ac5fc-default-rtdb.asia-southeast1.firebasedatabase.app",
              projectId: "pdsmaxvi-ac5fc",
              storageBucket: "pdsmaxvi-ac5fc.firebasestorage.app",
              messagingSenderId: "171752700719",
              appId: "1:171752700719:web:5ae803138b320edc1f3fda",
              measurementId: "G-DHC6S3XQH7"
            });
          }
          votingDatabase = firebase.database();
          console.log('✅ Firebase initialized successfully');
        } else {
          console.warn('⚠️ Firebase not available, using local storage');
          votingOpen = true;
        }
      } catch (error) {
        console.warn('⚠️ Firebase error:', error);
        votingOpen = true;
      }
    }

    function initializeVoting() {
      console.log('🚀 Initializing voting system...');
      
      // Generate unique user ID (bisa diganti dengan sistem login)
      currentUser = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      console.log('👤 User ID:', currentUser);
      
      // Load candidates first (this should always work)
      loadCandidates();
      
      // Load existing votes
      loadUserVotes();
      
      // Check voting status
      checkVotingStatus();
      
      // Load results
      loadResults();
      
      // Force show results section
      setTimeout(() => {
        const resultsSection = document.getElementById('resultsSection');
        if (resultsSection) {
          resultsSection.style.display = 'block';
          console.log('✅ Results section force displayed');
        }
      }, 1000);
    }

    function loadUserVotes() {
      if (votingDatabase) {
        votingDatabase.ref('votes/' + currentUser).once('value').then(snapshot => {
          const votes = snapshot.val();
          if (votes) {
            userVotes = votes;
            updateUI();
          }
        }).catch(error => {
          console.warn('Error loading votes:', error);
        });
      } else {
        // Fallback to localStorage
        const savedVotes = localStorage.getItem('userVotes_' + currentUser);
        if (savedVotes) {
          userVotes = JSON.parse(savedVotes);
          updateUI();
        }
      }
    }

    function loadCandidates() {
      console.log('🎯 Loading candidate pairs...');
      const pairsGrid = document.getElementById('candidatePairs');
      
      if (!pairsGrid) {
        console.error('❌ Candidate pairs grid not found!');
        return;
      }
      
      // Clear loading message
      const loadingMsg = document.getElementById('loadingMessage');
      if (loadingMsg) {
        loadingMsg.style.display = 'none';
      }
      
      console.log('📋 Candidate pairs:', candidatePairs);
      
      // Load candidate pairs
      candidatePairs.forEach((pair, index) => {
        console.log(`Creating pair ${index + 1}:`, pair.ketua.name + ' & ' + pair.wakil.name);
        const pairCard = createCandidatePairCard(pair);
        pairsGrid.appendChild(pairCard);
      });
      
      console.log('✅ All candidate pairs loaded');
      updateUI();
    }

    function createCandidatePairCard(pair) {
      console.log(`🎴 Creating pair card for ${pair.ketua.name} & ${pair.wakil.name}`);
      
      const pairCard = document.createElement('div');
      pairCard.className = 'candidate-pair';
      pairCard.dataset.pairId = pair.id;
      
      pairCard.innerHTML = `
        <div class="pair-header">
          <div class="pair-title">Pasangan ${pair.id.replace('pair', '')}</div>
          <div class="team-vision">${pair.teamVision}</div>
        </div>
        
        <div class="candidates-in-pair">
          <div class="candidate-in-pair ketua">
            <div class="candidate-photo">${pair.ketua.photo}</div>
            <div class="candidate-name">${pair.ketua.name}</div>
            <div class="candidate-position">${pair.ketua.position}</div>
            <div class="candidate-vision">${pair.ketua.vision}</div>
          </div>
          
          <div class="candidate-in-pair wakil">
            <div class="candidate-photo">${pair.wakil.photo}</div>
            <div class="candidate-name">${pair.wakil.name}</div>
            <div class="candidate-position">${pair.wakil.position}</div>
            <div class="candidate-vision">${pair.wakil.vision}</div>
          </div>
        </div>
        
        <button class="vote-button" onclick="voteForPair('${pair.id}')">
          <i class="fas fa-vote-yea"></i> Pilih Pasangan Ini
        </button>
        
        <div class="pair-vote-count">
          <div class="vote-count" id="count_${pair.id}">0 suara</div>
        </div>
      `;
      
      console.log(`✅ Pair card created for ${pair.ketua.name} & ${pair.wakil.name}`);
      return pairCard;
    }

    function createCandidateCard(candidate, type) {
      console.log(`🎴 Creating card for ${candidate.name} (${type})`);
      
      const card = document.createElement('div');
      card.className = 'candidate-card';
      card.dataset.candidateId = candidate.id;
      card.dataset.type = type;
      
      card.innerHTML = `
        <div class="candidate-photo">${candidate.photo}</div>
        <div class="candidate-name">${candidate.name}</div>
        <div class="candidate-position">${candidate.position}</div>
        <div class="candidate-vision">${candidate.vision}</div>
        <button class="vote-button" onclick="voteForCandidate('${candidate.id}', '${type}')">
          <i class="fas fa-vote-yea"></i> Pilih
        </button>
        <div class="vote-count" id="count_${candidate.id}">0 suara</div>
      `;
      
      console.log(`✅ Card created for ${candidate.name}`);
      return card;
    }

    function voteForPair(pairId) {
      if (!votingOpen) {
        showError('Voting sudah ditutup!');
        return;
      }
      
      // Check if user already voted
      if (userVotes.pair) {
        showError('Anda sudah memilih pasangan!');
        return;
      }
      
      // Find the pair
      const pair = candidatePairs.find(p => p.id === pairId);
      if (!pair) {
        showError('Pasangan tidak ditemukan!');
        return;
      }
      
      // Save vote for both ketua and wakil
      userVotes.pair = pairId;
      userVotes.ketua = pair.ketua.id;
      userVotes.wakil = pair.wakil.id;
      
      if (votingDatabase) {
        votingDatabase.ref('votes/' + currentUser).set(userVotes).then(() => {
          showSuccess(`Berhasil memilih pasangan ${pairId}!`);
          updateUI();
          updateVoteCounts();
        }).catch(error => {
          showError('Gagal menyimpan suara: ' + error.message);
        });
      } else {
        // Fallback to localStorage
        localStorage.setItem('userVotes_' + currentUser, JSON.stringify(userVotes));
        showSuccess(`Berhasil memilih pasangan ${pairId}!`);
        updateUI();
        updateVoteCounts();
      }
    }

    function voteForCandidate(candidateId, type) {
      if (!votingOpen) {
        showError('Voting sudah ditutup!');
        return;
      }
      
      if (userVotes[type] !== null) {
        showError(`Anda sudah memilih ${type === 'ketua' ? 'ketua' : 'wakil ketua'}!`);
        return;
      }
      
      // Save vote
      userVotes[type] = candidateId;
      
      if (votingDatabase) {
        votingDatabase.ref('votes/' + currentUser).set(userVotes).then(() => {
          showSuccess(`Berhasil memilih ${candidateId}!`);
          updateUI();
          updateVoteCounts();
        }).catch(error => {
          showError('Gagal menyimpan suara: ' + error.message);
        });
      } else {
        // Fallback to localStorage
        localStorage.setItem('userVotes_' + currentUser, JSON.stringify(userVotes));
        showSuccess(`Berhasil memilih ${candidateId}!`);
        updateUI();
      }
      
      // Check if both votes are complete
      if (userVotes.ketua !== null && userVotes.wakil !== null) {
        showSuccess('Terima kasih! Anda telah menyelesaikan voting untuk ketua dan wakil ketua.');
      }
    }

    function updateUI() {
      // Update vote buttons for pairs
      document.querySelectorAll('.candidate-pair').forEach(pairCard => {
        const button = pairCard.querySelector('.vote-button');
        const pairId = pairCard.dataset.pairId;
        
        if (userVotes.pair === pairId) {
          button.innerHTML = '<i class="fas fa-check"></i> Terpilih';
          button.className = 'vote-button voted';
          button.disabled = true;
          pairCard.classList.add('selected');
        } else if (userVotes.pair !== null) {
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-lock"></i> Tidak Dapat Dipilih';
        }
      });

      // Update vote buttons for individual candidates (fallback)
      document.querySelectorAll('.candidate-card').forEach(card => {
        const button = card.querySelector('.vote-button');
        const candidateId = card.dataset.candidateId;
        const type = card.dataset.type;
        
        if (userVotes[type] === candidateId) {
          button.innerHTML = '<i class="fas fa-check"></i> Terpilih';
          button.className = 'vote-button voted';
          button.disabled = true;
          card.classList.add('selected');
        } else if (userVotes[type] !== null) {
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-lock"></i> Tidak Dapat Dipilih';
        }
      });
    }

    function updateVoteCounts() {
      // Count votes for each pair
      const pairVoteCounts = {};
      
      // Initialize vote counts for pairs
      candidatePairs.forEach(pair => {
        pairVoteCounts[pair.id] = 0;
      });
      
      if (votingDatabase) {
        // Firebase mode
        votingDatabase.ref('votes').once('value').then(snapshot => {
          const allVotes = snapshot.val();
          if (allVotes) {
            Object.values(allVotes).forEach(userVote => {
              if (userVote.pair) {
                pairVoteCounts[userVote.pair]++;
              }
            });
          }
          
          // Update UI for pairs
          updatePairCountsUI(pairVoteCounts);
        });
      } else {
        // LocalStorage fallback mode
        const allVotes = {};
        
        // Get all votes from localStorage
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('userVotes_')) {
            try {
              const userVote = JSON.parse(localStorage.getItem(key));
              if (userVote && userVote.pair) {
                pairVoteCounts[userVote.pair]++;
              }
            } catch (e) {
              console.warn('Error parsing vote from localStorage:', e);
            }
          }
        }
        
        // Update UI for pairs
        updatePairCountsUI(pairVoteCounts);
      }
    }

    function updatePairCountsUI(pairVoteCounts) {
      // Update vote count displays
      Object.keys(pairVoteCounts).forEach(pairId => {
        const countElement = document.getElementById('count_' + pairId);
        if (countElement) {
          countElement.textContent = pairVoteCounts[pairId] + ' suara';
        }
      });
      
      // Also update results section
      displayPairResults({});
    }

    function checkVotingStatus() {
      if (votingDatabase) {
        votingDatabase.ref('votingStatus').once('value').then(snapshot => {
          const status = snapshot.val();
          if (status) {
            votingOpen = status.open;
            updateVotingStatus();
          }
        });
      }
      
      updateVotingStatus();
    }

    function updateVotingStatus() {
      const statusElement = document.getElementById('votingStatus');
      if (votingOpen) {
        statusElement.innerHTML = '<i class="fas fa-check-circle"></i> Voting Aktif';
        statusElement.className = 'voting-status status-active';
      } else {
        statusElement.innerHTML = '<i class="fas fa-times-circle"></i> Voting Ditutup';
        statusElement.className = 'voting-status status-closed';
      }
    }

    function loadResults() {
      if (votingDatabase) {
        // Firebase mode
        votingDatabase.ref('votes').on('value', snapshot => {
          const allVotes = snapshot.val();
          if (allVotes) {
            displayPairResults(allVotes);
          } else {
            // Show empty results if no votes yet
            displayPairResults({});
          }
        });
      } else {
        // LocalStorage fallback mode
        console.log('📊 Loading results from localStorage...');
        const allVotes = {};
        
        // Get all votes from localStorage
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('userVotes_')) {
            try {
              const userVote = JSON.parse(localStorage.getItem(key));
              if (userVote && userVote.pair) {
                allVotes[key] = userVote;
              }
            } catch (e) {
              console.warn('Error parsing vote from localStorage:', e);
            }
          }
        }
        
        displayPairResults(allVotes);
      }
    }

    function displayPairResults(allVotes) {
      console.log('📊 Displaying pair results...', allVotes);
      
      const pairVoteCounts = {};
      
      // Initialize counts for pairs
      candidatePairs.forEach(pair => {
        pairVoteCounts[pair.id] = 0;
      });
      
      // Count votes for pairs
      Object.values(allVotes).forEach(userVote => {
        if (userVote && userVote.pair) {
          pairVoteCounts[userVote.pair]++;
        }
      });
      
      console.log('📊 Vote counts:', pairVoteCounts);
      
      // Display results
      const resultsGrid = document.getElementById('resultsGrid');
      const resultsSection = document.getElementById('resultsSection');
      
      if (!resultsGrid) {
        console.error('❌ Results grid not found!');
        return;
      }
      
      resultsGrid.innerHTML = '';
      
      // Sort by vote count (descending)
      const sortedPairs = Object.entries(pairVoteCounts).sort((a, b) => b[1] - a[1]);
      
      console.log('📊 Sorted pairs:', sortedPairs);
      
      // Always show all pairs, even with 0 votes
      candidatePairs.forEach((pair, index) => {
        const count = pairVoteCounts[pair.id] || 0;
        
        const resultCard = document.createElement('div');
        resultCard.className = 'result-card pair-result';
        resultCard.innerHTML = `
          <div class="result-rank">#${index + 1}</div>
          <div class="pair-candidates">
            <div class="result-candidate">
              <div class="result-photo">${pair.ketua.photo}</div>
              <div class="result-name">${pair.ketua.name}</div>
              <div class="result-position">${pair.ketua.position}</div>
            </div>
            <div class="pair-separator">&</div>
            <div class="result-candidate">
              <div class="result-photo">${pair.wakil.photo}</div>
              <div class="result-name">${pair.wakil.name}</div>
              <div class="result-position">${pair.wakil.position}</div>
            </div>
          </div>
          <div class="result-votes">${count} suara</div>
          <div class="team-vision">${pair.teamVision}</div>
        `;
        resultsGrid.appendChild(resultCard);
      });
      
      // Show results section
      if (resultsSection) {
        resultsSection.style.display = 'block';
        console.log('✅ Results section displayed');
      }
      
      console.log('✅ Pair results displayed');
    }

    function displayResults(allVotes) {
      const voteCounts = {};
      
      // Initialize counts
      Object.keys(candidates).forEach(type => {
        candidates[type].forEach(candidate => {
          voteCounts[candidate.id] = 0;
        });
      });
      
      // Count votes
      Object.values(allVotes).forEach(userVote => {
        if (userVote.ketua) voteCounts[userVote.ketua]++;
        if (userVote.wakil) voteCounts[userVote.wakil]++;
      });
      
      // Create results
      const results = [];
      
      // Ketua results
      const ketuaResults = candidates.ketua.map(candidate => ({
        ...candidate,
        votes: voteCounts[candidate.id] || 0
      })).sort((a, b) => b.votes - a.votes);
      
      // Wakil results
      const wakilResults = candidates.wakil.map(candidate => ({
        ...candidate,
        votes: voteCounts[candidate.id] || 0
      })).sort((a, b) => b.votes - a.votes);
      
      // Display results
      const resultsSection = document.getElementById('resultsSection');
      const resultsGrid = document.getElementById('resultsGrid');
      
      resultsGrid.innerHTML = '';
      
      // Add ketua results
      resultsGrid.innerHTML += '<h3 style="grid-column: 1/-1; text-align: center; margin: 20px 0; color: #333;">👑 Hasil Ketua</h3>';
      ketuaResults.forEach((result, index) => {
        const resultItem = document.createElement('div');
        resultItem.className = 'result-item';
        resultItem.innerHTML = `
          <div class="result-rank">${index + 1}</div>
          <div class="result-info">
            <div class="result-name">${result.name}</div>
            <div class="result-position">${result.position}</div>
            <div class="result-votes">${result.votes} suara</div>
          </div>
        `;
        resultsGrid.appendChild(resultItem);
      });
      
      // Add wakil results
      resultsGrid.innerHTML += '<h3 style="grid-column: 1/-1; text-align: center; margin: 20px 0; color: #333;">🛡️ Hasil Wakil Ketua</h3>';
      wakilResults.forEach((result, index) => {
        const resultItem = document.createElement('div');
        resultItem.className = 'result-item';
        resultItem.innerHTML = `
          <div class="result-rank">${index + 1}</div>
          <div class="result-info">
            <div class="result-name">${result.name}</div>
            <div class="result-position">${result.position}</div>
            <div class="result-votes">${result.votes} suara</div>
          </div>
        `;
        resultsGrid.appendChild(resultItem);
      });
      
      resultsSection.style.display = 'block';
    }

    function showError(message) {
      const errorElement = document.getElementById('errorMessage');
      const errorText = document.getElementById('errorText');
      errorText.textContent = message;
      errorElement.style.display = 'block';
      
      setTimeout(() => {
        errorElement.style.display = 'none';
      }, 5000);
    }

    function showSuccess(message) {
      const successElement = document.getElementById('successMessage');
      const successText = document.getElementById('successText');
      successText.textContent = message;
      successElement.style.display = 'block';
      
      setTimeout(() => {
        successElement.style.display = 'none';
      }, 5000);
    }

    // Initialize AOS (with safety check and delay)
    function initAOS() {
      if (typeof AOS !== 'undefined') {
        AOS.init({
          duration: 1000,
          once: true
        });
        console.log('✅ AOS initialized successfully');
      } else {
        console.warn('⚠️ AOS library not loaded, animations disabled');
      }
    }

    // Try to initialize AOS immediately, then retry after delay
    initAOS();
    setTimeout(initAOS, 1000); // Retry after 1 second
  </script>
</body>
</html>
